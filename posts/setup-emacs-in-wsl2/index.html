<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Emacs in WSL2 | So I Write</title><meta name=keywords content="emacs"><meta name=description content="Using Emacs on windows is always an imperfect experience, luckly windows10 comes with WSL2 now, which lets you install Emacs in WSL2 and use it on windows now. I did some hacking to make the experience little bit better, which includes:
 open any file on windows in emacs@wsl2 setup org-capture on chrome on windows and capture notes using emacs@wsl2 open links in org-mode in emacs@wsl2 using windows default apps. e."><meta name=author content="shelper"><link rel=canonical href=https://shelper.github.io/posts/setup-emacs-in-wsl2/><link crossorigin=anonymous href=/assets/css/stylesheet.min.26a03aaebed848bcf4fd29e1fd968f84febc16fd6e77126eaa4d1969fdfb3503.css integrity="sha256-JqA6rr7YSLz0/Snh/ZaPhP68Fv1udxJuqk0Zaf37NQM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://shelper.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://shelper.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://shelper.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://shelper.github.io/apple-touch-icon.png><link rel=mask-icon href=https://shelper.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Emacs in WSL2"><meta property="og:description" content="Using Emacs on windows is always an imperfect experience, luckly windows10 comes with WSL2 now, which lets you install Emacs in WSL2 and use it on windows now. I did some hacking to make the experience little bit better, which includes:
 open any file on windows in emacs@wsl2 setup org-capture on chrome on windows and capture notes using emacs@wsl2 open links in org-mode in emacs@wsl2 using windows default apps. e."><meta property="og:type" content="article"><meta property="og:url" content="https://shelper.github.io/posts/setup-emacs-in-wsl2/"><meta property="og:image" content="https://shelper.github.io/profile.png"><meta property="article:section" content="posts"><meta property="article:modified_time" content="2022-05-13T10:51:21-04:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shelper.github.io/profile.png"><meta name=twitter:title content="Emacs in WSL2"><meta name=twitter:description content="Using Emacs on windows is always an imperfect experience, luckly windows10 comes with WSL2 now, which lets you install Emacs in WSL2 and use it on windows now. I did some hacking to make the experience little bit better, which includes:
 open any file on windows in emacs@wsl2 setup org-capture on chrome on windows and capture notes using emacs@wsl2 open links in org-mode in emacs@wsl2 using windows default apps. e."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://shelper.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Emacs in WSL2","item":"https://shelper.github.io/posts/setup-emacs-in-wsl2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Emacs in WSL2","name":"Emacs in WSL2","description":"Using Emacs on windows is always an imperfect experience, luckly windows10 comes with WSL2 now, which lets you install Emacs in WSL2 and use it on windows now. I did some hacking to make the experience little bit better, which includes:\n open any file on windows in emacs@wsl2 setup org-capture on chrome on windows and capture notes using emacs@wsl2 open links in org-mode in emacs@wsl2 using windows default apps. e.","keywords":["emacs"],"articleBody":"Using Emacs on windows is always an imperfect experience, luckly windows10 comes with WSL2 now, which lets you install Emacs in WSL2 and use it on windows now. I did some hacking to make the experience little bit better, which includes:\n open any file on windows in emacs@wsl2 setup org-capture on chrome on windows and capture notes using emacs@wsl2 open links in org-mode in emacs@wsl2 using windows default apps. e.g., open https links using chrome on windows, open document links in MS-office on windows, etc. copy paste sharing between windows and wsl2 fix for some keyboard shortcuts thatâ€™s been screened by windows by default setup outlook to create outlook links(uuid based) for emails/meetings/contacts in outlook, then open links in org-mode using outlook insert files into emacs@wsl2  lets go into the steps for each of the above fixes\nprecondition On windows 10 you can install GWSL to enable emacs@wsl2 with gui, or you can setup your own VcXsrv so you can open emacs@wsl2 with gui.\nopen files on windows using emacs@wsl2 in order to add a context menu to open windows files in WSL2, i created a python file with content below:\nimport sys import subprocess import os import re import win32gui class WindowMgr: \"\"\"Encapsulates some calls to the winapi for window management\"\"\" def __init__(self): \"\"\"Constructor\"\"\" self._handle = None def find_window(self, class_name, window_name=None): \"\"\"find a window by its class_name\"\"\" self._handle = win32gui.FindWindow(class_name, window_name) def _window_enum_callback(self, hwnd, wildcard): \"\"\"Pass to win32gui.EnumWindows() to check all the opened windows\"\"\" if re.match(wildcard, str(win32gui.GetWindowText(hwnd))) is not None: self._handle = hwnd def find_window_wildcard(self, wildcard): \"\"\"find a window whose title matches the wildcard regex\"\"\" self._handle = None win32gui.EnumWindows(self._window_enum_callback, wildcard) def set_foreground(self): \"\"\"put the window in the foreground\"\"\" win32gui.SetForegroundWindow(self._handle) if __name__ == \"__main__\": file_name = ( '\"' + sys.argv[1] + '\"' if sys.argv[1].startswith(\"org-protocol\") else os.path.abspath(sys.argv[1]).replace(\"\\\\\", \"/\").replace(\"C:\", \"/mnt/c\") ) wsl_path_prefix = \"//wsl$/Ubuntu/\" if file_name.startswith(wsl_path_prefix): file_name = file_name.replace(wsl_path_prefix, \"/\") command = \" \".join( [ \"C:/Windows/System32/wsl.exe\", \"-d\", \"Ubuntu\", \"emacsclient\", \"-n\", file_name, ] ) subprocess.Popen(command, shell=True) w = WindowMgr() w.find_window_wildcard(\".*Doom Emac\") w.set_foreground()   then i setup the context menu by the following reg file:\nWindows Registry Editor Version 5.00 [HKEY_CLASSES_ROOT\\*\\shell\\Open in WSL Emacs] @=\"WSL Emacs\" \"icon\"=\"\\\"C:\\\\Users\\\\username\\\\scoop\\\\apps\\\\emacs\\\\current\\\\share\\\\icons\\\\hicolor\\\\scalable\\\\apps\\\\emacs.ico\\\"\" [HKEY_CLASSES_ROOT\\*\\shell\\Open in WSL Emacs\\Command] @=\"\\\"C:\\\\Users\\\\username\\\\scoop\\\\apps\\\\python\\\\current\\\\pythonw.exe\\\" \\\"C:\\\\Path\\\\to\\\\wsl_emacs.py\\\" \\\"%1\\\"\"   This works fine on windows as long you have pythonw.exe and you have the icon file specified above exists if you use python.exe instead of pythonw.exe, it still works but will always generate a cmd window when you call emacs@wsl2.\nsetup org capture for emacs@wsl2 if you already have the above script wsl_emacs.py in place, then it is relatively simple, just run the reg file below\nWindows Registry Editor Version 5.00 [HKEY_CLASSES_ROOT\\org-protocol] @=\"URL:Org Protocol\" \"URL Protocol\"=\"\" [HKEY_CLASSES_ROOT\\org-protocol\\shell] [HKEY_CLASSES_ROOT\\org-protocol\\shell\\open] [HKEY_CLASSES_ROOT\\org-protocol\\shell\\open\\command] @=\"\\\"C:\\\\Users\\\\username\\\\scoop\\\\apps\\\\python\\\\current\\\\pythonw.exe\\\" \\\"C:\\\\Path\\\\to\\\\wsl_emacs.py\\\" \\\"%1\\\"\" of coures you need to install the org-capture extension, and add your own capture template for org-capture, see more details at here\nopen links in org-mode in emacs@wsl2 using windows apps this is done by installing the wslu on your wsl2, and then you can config your org-mode by:\n;; \"Set org-file-apps based on the system type\" (when IS-WSL (setq org-file-apps '((remote . emacs) (auto-mode . emacs) (directory . emacs) (\"\\\\.mm\\\\'\" . \"wslview \\\"%s\\\"\") (\"\\\\.x?html?\\\\'\" . \"wslview \\\"%s\\\"\") (\"\\\\.pptx?\\\\'\" . \"wslview \\\"%s\\\"\") (\"\\\\.xlsx?\\\\'\" . \"wslview \\\"%s\\\"\") (\"\\\\.docx?\\\\'\" . \"wslview \\\"%s\\\"\") (\"\\\\.pdf\\\\'\" . \"wslview \\\"%s\\\"\"))) ;; need to set explorer for open weblinks and htmls seperately (setq browse-url-generic-program \"/mnt/c/Program Files \\(x86\\)/Google/Chrome/Application/chrome.exe\") ) copy paste sharing between wsl2 and windows host This can be easily done using GWSL above\nfix keyboard shortcut for C-shift-0 I donâ€™t know why but it seems windows blocks this keybind to be used. this is annoying, what i did is i remap this C-shift-0 to something i dont use with powertoys on windows, e.g., i remap C-shift-0 to C-shift-., then i have the following line to set my emacs keybinding\n;; Windows 10 blocks Ctrl-Shift-0, So we using powertoy to cheat the system ;; when we press \"C-)\", it becomes \"C-\" (cond (IS-WSL (map! \"C-\" #'sp-forward-slurp-sexp)) (t (map! \"C-)\" #'sp-forward-slurp-sexp))) Outlook for Org-mode   add macro to outlook for copying link to objects in outlook\n  check developer in File  Options  Customize Ribbon  Main Tabs  Developer\n  in developer tab create new VBA macro, and input:\nSub AddLinkToMessageInClipboard() Dim objMail As Object 'was earlier Outlook.MailItem Dim doClipboard As New DataObject Dim message As String 'One and ONLY one message muse be selected If Application.ActiveExplorer.Selection.Count  1 Then MsgBox (\"Select one and ONLY one message.\") Exit Sub End If Set objMail = Application.ActiveExplorer.Selection.Item(1) If objMail.Class = olMail Then doClipboard.SetText \"[[outlook:\" + objMail.EntryID + \"][MESSAGE: \" + objMail.Subject + \" (\" + objMail.SenderName + \")]]\" ElseIf objMail.Class = olAppointment Then doClipboard.SetText \"[[outlook:\" + objMail.EntryID + \"][MEETING: \" + objMail.Subject + \" (\" + objMail.Organizer + \")]]\" ElseIf objMail.Class = olTask Then doClipboard.SetText \"[[outlook:\" + objMail.EntryID + \"][TASK: \" + objMail.Subject + \" (\" + objMail.Owner + \")]]\" ElseIf objMail.Class = olContact Then doClipboard.SetText \"[[outlook:\" + objMail.EntryID + \"][CONTACT: \" + objMail.Subject + \" (\" + objMail.FullName + \")]]\" ElseIf objMail.Class = olJournal Then doClipboard.SetText \"[[outlook:\" + objMail.EntryID + \"][JOURNAL: \" + objMail.Subject + \" (\" + objMail.Type + \")]]\" ElseIf objMail.Class = olNote Then doClipboard.SetText \"[[outlook:\" + objMail.EntryID + \"][NOTE: \" + objMail.Subject + \" (\" + \" \" + \")]]\" Else doClipboard.SetText \"[[outlook:\" + objMail.EntryID + \"][ITEM: \" + objMail.Subject + \" (\" + objMail.MessageClass + \")]]\" End If doClipboard.PutInClipboard End Sub   in visual basic editor window select Tools  References, if the option is disabled (grayed) then try to close all office apps and restart it, then click browse... and add FM20.dll\n  then run SELFCERT.exe in office folder and create personal certificate\n  in visual basic editor window select Tools  Digital signature, choose the created certificate.\n  you should be able to run the macro now, you can further add the macro to the quick access toolbar through File  Options  QuickAccessToolbar  choose commands from: Macro  your Macro\n    Create registry entry for handling links to outlook object:\nWindows Registry Editor Version 5.00 [HKEY_CLASSES_ROOT\\outlook] @=\"URL:Outlook Folders\" \"URL protocol\"=\"\" [HKEY_CLASSES_ROOT\\outlook\\DefaultIcon] @=\"C:\\\\Program Files\\\\Microsoft Office\\\\root\\\\Office16\\\\OUTLOOK.EXE\" [HKEY_CLASSES_ROOT\\outlook\\shell] [HKEY_CLASSES_ROOT\\outlook\\shell\\open] [HKEY_CLASSES_ROOT\\outlook\\shell\\open\\command] @=\"\\\"C:\\\\Program Files\\\\Microsoft Office\\\\root\\\\Office16\\\\OUTLOOK.EXE\\\" /select \\\"%1\\\"\"   Setup org-mode in your own emacs configuration put:\n(org-link-set-parameters \"outlook\" :follow (lambda (id) (cond (IS-WSL (shell-command (concat \"wslview \" \"outlook:\" id))) (IS-WINDOWS (w32-shell-execute \"open\" (concat \"outlook:\" id))) )))   insert windows files into emacs@wsl2 since emacs runs in wsl, we cannot drag and drop files between windows and emacs@wsl2. so i wrote a simple script to get the path of files in windows, and convert it to path in wsl2\nimport os import sys file_path = os.path.abspath(sys.argv[-1]).replace(\"\\\\\", \"/\").replace(\"C:\", \"/mnt/c\") wsl_path_prefix = \"//wsl$/Ubuntu/\" if file_path.startswith(wsl_path_prefix): file_path = file_path.replace(wsl_path_prefix, \"/\") command = \"echo \" + file_path.strip() + \"| clip\" os.system(command) then I create the context menu WSL Path by the registry file\nWindows Registry Editor Version 5.00 [HKEY_CLASSES_ROOT\\*\\shell\\Copy WSL path] @=\"WSL Path\" [HKEY_CLASSES_ROOT\\*\\shell\\Copy WSL path\\Command] @=\"\\\"C:\\\\Users\\\\username\\\\scoop\\\\apps\\\\python\\\\current\\\\pythonw.exe\\\" \\\"C:\\\\path\\\\to\\\\wsl_path.py\\\" \\\"%1\\\"\" share clipboard between windows host and WSL2 this is done by using powershell to get clipboard image saved and read the image into xclip for clipboard access in WSL2\n(defun win2wsl-clipped-image() \"use powershell to save the clipped image to wsl and load it to xclip\" (let* ((powershell \"/mnt/c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe\") (file-name \"//wsl$/Ubuntu/home/mpnv38/tmp/clip_win2wsl.png\") (file-name-wsl \"~/tmp/clip_win2wsl.png\") ) (shell-command (concat powershell \" -noprofile -command \\\"(Get-Clipboard -Format Image).Save(\\\\\\\"\" file-name \"\\\\\\\")\\\"\")) (call-process-shell-command (concat \"xclip -selection clipboard -t image/png -i \" file-name-wsl)) ) ) (advice-add 'org-download-clipboard :before #'win2wsl-clipped-image) This is it, let me know in comments if you have any question or suggestion!\n","wordCount":"1226","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"2022-05-13T10:51:21-04:00","author":[{"@type":"Person","name":"shelper"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://shelper.github.io/posts/setup-emacs-in-wsl2/"},"publisher":{"@type":"Organization","name":"So I Write","logo":{"@type":"ImageObject","url":"https://shelper.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://shelper.github.io/ accesskey=h title="So I Write (Alt + H)">So I Write</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://shelper.github.io/posts title=Posts><span>Posts</span></a></li><li><a href=https://shelper.github.io/archives title=Archive><span>Archive</span></a></li><li><a href=https://shelper.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://shelper.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://shelper.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://shelper.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://shelper.github.io/posts/>Posts</a></div><h1 class=post-title>Emacs in WSL2</h1><div class=post-meta><span title="2022-05-13 10:51:21 -0400 -0400">May 13, 2022</span>&nbsp;Â·&nbsp;6 min&nbsp;Â·&nbsp;shelper&nbsp;|&nbsp;<a href=https://github.com/shelper/shelper.github.io/tree/main/content/posts/Setup-Emacs-in-WSL2.md rel="noopener noreferrer" target=_blank>Edit Post</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#precondition aria-label=precondition>precondition</a></li><li><a href=#open-files-on-windows-using-emacs-wsl2 aria-label="open files on windows using emacs@wsl2">open files on windows using emacs@wsl2</a></li><li><a href=#setup-org-capture-for-emacs-wsl2 aria-label="setup org capture  for emacs@wsl2">setup org capture for emacs@wsl2</a></li><li><a href=#open-links-in-org-mode-in-emacs-wsl2-using-windows-apps aria-label="open links in org-mode in emacs@wsl2 using windows apps">open links in org-mode in emacs@wsl2 using windows apps</a></li><li><a href=#copy-paste-sharing-between-wsl2-and-windows-host aria-label="copy paste sharing between wsl2 and windows host">copy paste sharing between wsl2 and windows host</a></li><li><a href=#fix-keyboard-shortcut-for-c-shift-0 aria-label="fix keyboard shortcut for C-shift-0">fix keyboard shortcut for C-shift-0</a></li><li><a href=#outlook-for-org-mode aria-label="Outlook for Org-mode">Outlook for Org-mode</a></li><li><a href=#insert-windows-files-into-emacs-wsl2 aria-label="insert windows files into emacs@wsl2">insert windows files into emacs@wsl2</a></li><li><a href=#share-clipboard-between-windows-host-and-wsl2 aria-label="share clipboard between windows host and WSL2">share clipboard between windows host and WSL2</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const e=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${e}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>Using Emacs on windows is always an imperfect experience, luckly windows10 comes with WSL2 now, which lets you install Emacs in WSL2 and use it on windows now.
I did some hacking to make the experience little bit better, which includes:</p><ol><li>open any file on windows in emacs@wsl2</li><li>setup org-capture on chrome on windows and capture notes using emacs@wsl2</li><li>open links in org-mode in emacs@wsl2 using windows default apps. e.g., open https links using chrome on windows, open document links in MS-office on windows, etc.</li><li>copy paste sharing between windows and wsl2</li><li>fix for some keyboard shortcuts that&rsquo;s been screened by windows by default</li><li>setup outlook to create outlook links(uuid based) for emails/meetings/contacts in outlook, then open links in org-mode using outlook</li><li>insert files into emacs@wsl2</li></ol><p>lets go into the steps for each of the above fixes</p><h2 id=precondition>precondition<a hidden class=anchor aria-hidden=true href=#precondition>#</a></h2><p>On windows 10 you can install <a href=https://github.com/Opticos/GWSL-Source>GWSL</a> to enable emacs@wsl2 with gui, or you can setup your own VcXsrv so you can open emacs@wsl2 with gui.</p><h2 id=open-files-on-windows-using-emacs-wsl2>open files on windows using emacs@wsl2<a hidden class=anchor aria-hidden=true href=#open-files-on-windows-using-emacs-wsl2>#</a></h2><p>in order to add a context menu to open windows files in WSL2, i created a python file with content below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>win32gui</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WindowMgr</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Encapsulates some calls to the winapi for window management&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Constructor&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_handle</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>find_window</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>class_name</span><span class=p>,</span> <span class=n>window_name</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;find a window by its class_name&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_handle</span> <span class=o>=</span> <span class=n>win32gui</span><span class=o>.</span><span class=n>FindWindow</span><span class=p>(</span><span class=n>class_name</span><span class=p>,</span> <span class=n>window_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_window_enum_callback</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>hwnd</span><span class=p>,</span> <span class=n>wildcard</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Pass to win32gui.EnumWindows() to check all the opened windows&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>re</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=n>wildcard</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>win32gui</span><span class=o>.</span><span class=n>GetWindowText</span><span class=p>(</span><span class=n>hwnd</span><span class=p>)))</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_handle</span> <span class=o>=</span> <span class=n>hwnd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>find_window_wildcard</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>wildcard</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;find a window whose title matches the wildcard regex&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_handle</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=n>win32gui</span><span class=o>.</span><span class=n>EnumWindows</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_window_enum_callback</span><span class=p>,</span> <span class=n>wildcard</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>set_foreground</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;put the window in the foreground&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>win32gui</span><span class=o>.</span><span class=n>SetForegroundWindow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_handle</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>file_name</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;&#34;&#39;</span> <span class=o>+</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=s1>&#39;&#34;&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;org-protocol&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>abspath</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\\</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;/&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;C:&#34;</span><span class=p>,</span> <span class=s2>&#34;/mnt/c&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>wsl_path_prefix</span> <span class=o>=</span> <span class=s2>&#34;//wsl$/Ubuntu/&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>file_name</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>wsl_path_prefix</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>file_name</span> <span class=o>=</span> <span class=n>file_name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>wsl_path_prefix</span><span class=p>,</span> <span class=s2>&#34;/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>command</span> <span class=o>=</span> <span class=s2>&#34; &#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;C:/Windows/System32/wsl.exe&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;-d&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Ubuntu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;emacsclient&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;-n&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>file_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=n>command</span><span class=p>,</span> <span class=n>shell</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>w</span> <span class=o>=</span> <span class=n>WindowMgr</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>w</span><span class=o>.</span><span class=n>find_window_wildcard</span><span class=p>(</span><span class=s2>&#34;.*Doom Emac&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>w</span><span class=o>.</span><span class=n>set_foreground</span><span class=p>()</span>
</span></span></code></pre></div><ul><li><p>then i setup the context menu by the following reg file:</p><pre tabindex=0><code class=language-nil data-lang=nil>Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\*\shell\Open in WSL Emacs]
@=&#34;WSL Emacs&#34;
&#34;icon&#34;=&#34;\&#34;C:\\Users\\username\\scoop\\apps\\emacs\\current\\share\\icons\\hicolor\\scalable\\apps\\emacs.ico\&#34;&#34;

[HKEY_CLASSES_ROOT\*\shell\Open in WSL Emacs\Command]
@=&#34;\&#34;C:\\Users\\username\\scoop\\apps\\python\\current\\pythonw.exe\&#34; \&#34;C:\\Path\\to\\wsl_emacs.py\&#34; \&#34;%1\&#34;&#34;
</code></pre></li></ul><p>This works fine on windows as long you have <code>pythonw.exe</code> and you have the icon file specified above exists
if you use <code>python.exe</code> instead of <code>pythonw.exe</code>, it still works but will always generate a cmd window when you call emacs@wsl2.</p><h2 id=setup-org-capture-for-emacs-wsl2>setup org capture for emacs@wsl2<a hidden class=anchor aria-hidden=true href=#setup-org-capture-for-emacs-wsl2>#</a></h2><p>if you already have the above script <code>wsl_emacs.py</code> in place, then it is relatively simple, just run the reg file below</p><pre tabindex=0><code class=language-nil data-lang=nil>Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\org-protocol]
@=&#34;URL:Org Protocol&#34;
&#34;URL Protocol&#34;=&#34;&#34;

[HKEY_CLASSES_ROOT\org-protocol\shell]

[HKEY_CLASSES_ROOT\org-protocol\shell\open]

[HKEY_CLASSES_ROOT\org-protocol\shell\open\command]
@=&#34;\&#34;C:\\Users\\username\\scoop\\apps\\python\\current\\pythonw.exe\&#34; \&#34;C:\\Path\\to\\wsl_emacs.py\&#34; \&#34;%1\&#34;&#34;
</code></pre><p>of coures you need to install the <a href=https://chrome.google.com/webstore/detail/org-capture/kkkjlfejijcjgjllecmnejhogpbcigdc>org-capture extension</a>, and add your own capture template for org-capture, see more details at <a href=https://orgmode.org/worg/org-contrib/org-protocol.html>here</a></p><h2 id=open-links-in-org-mode-in-emacs-wsl2-using-windows-apps>open links in org-mode in emacs@wsl2 using windows apps<a hidden class=anchor aria-hidden=true href=#open-links-in-org-mode-in-emacs-wsl2-using-windows-apps>#</a></h2><p>this is done by installing the <a href=https://github.com/wslutilities/wslu>wslu</a> on your wsl2, and then you can config your org-mode by:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl><span class=c1>;; &#34;Set org-file-apps based on the system type&#34;</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nb>when</span> <span class=nv>IS-WSL</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>setq</span> <span class=nv>org-file-apps</span> <span class=o>&#39;</span><span class=p>((</span><span class=nv>remote</span> <span class=o>.</span> <span class=nv>emacs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=nv>auto-mode</span> <span class=o>.</span> <span class=nv>emacs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=nv>directory</span> <span class=o>.</span> <span class=nv>emacs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=s>&#34;\\.mm\\&#39;&#34;</span> <span class=o>.</span> <span class=s>&#34;wslview \&#34;%s\&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=s>&#34;\\.x?html?\\&#39;&#34;</span> <span class=o>.</span> <span class=s>&#34;wslview \&#34;%s\&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=s>&#34;\\.pptx?\\&#39;&#34;</span> <span class=o>.</span> <span class=s>&#34;wslview \&#34;%s\&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=s>&#34;\\.xlsx?\\&#39;&#34;</span> <span class=o>.</span> <span class=s>&#34;wslview \&#34;%s\&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=s>&#34;\\.docx?\\&#39;&#34;</span> <span class=o>.</span> <span class=s>&#34;wslview \&#34;%s\&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=s>&#34;\\.pdf\\&#39;&#34;</span> <span class=o>.</span>  <span class=s>&#34;wslview \&#34;%s\&#34;&#34;</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>  <span class=c1>;; need to set explorer for open weblinks and htmls seperately</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>setq</span> <span class=nv>browse-url-generic-program</span> <span class=s>&#34;/mnt/c/Program Files \(x86\)/Google/Chrome/Application/chrome.exe&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span></code></pre></div><h2 id=copy-paste-sharing-between-wsl2-and-windows-host>copy paste sharing between wsl2 and windows host<a hidden class=anchor aria-hidden=true href=#copy-paste-sharing-between-wsl2-and-windows-host>#</a></h2><p>This can be easily done using GWSL above</p><h2 id=fix-keyboard-shortcut-for-c-shift-0>fix keyboard shortcut for C-shift-0<a hidden class=anchor aria-hidden=true href=#fix-keyboard-shortcut-for-c-shift-0>#</a></h2><p>I don&rsquo;t know why but it seems windows blocks this keybind to be used.
this is annoying, what i did is i remap this C-shift-0 to something i dont use with powertoys on windows, e.g., i remap C-shift-0 to C-shift-., then i have the following line to set my emacs keybinding</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl><span class=c1>;; Windows 10 blocks Ctrl-Shift-0, So we using powertoy to cheat the system</span>
</span></span><span class=line><span class=cl><span class=c1>;; when we press &#34;C-)&#34;, it becomes &#34;C-&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nb>cond</span> <span class=p>(</span><span class=nv>IS-WSL</span> <span class=p>(</span><span class=nv>map!</span> <span class=s>&#34;C-&gt;&#34;</span> <span class=nf>#&#39;</span><span class=nv>sp-forward-slurp-sexp</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=no>t</span> <span class=p>(</span><span class=nv>map!</span> <span class=s>&#34;C-)&#34;</span> <span class=nf>#&#39;</span><span class=nv>sp-forward-slurp-sexp</span><span class=p>)))</span>
</span></span></code></pre></div><h2 id=outlook-for-org-mode>Outlook for Org-mode<a hidden class=anchor aria-hidden=true href=#outlook-for-org-mode>#</a></h2><ul><li><p>add macro to outlook for copying link to objects in outlook</p><ul><li><p>check developer in <code>File > Options > Customize Ribbon > Main Tabs > Developer</code></p></li><li><p>in developer tab create new VBA macro, and input:</p><pre tabindex=0><code class=language-nil data-lang=nil>Sub AddLinkToMessageInClipboard()
    Dim objMail As Object
    &#39;was earlier Outlook.MailItem
    Dim doClipboard As New DataObject
    Dim message As String

    &#39;One and ONLY one message muse be selected
    If Application.ActiveExplorer.Selection.Count &lt;&gt; 1 Then
        MsgBox (&#34;Select one and ONLY one message.&#34;)
        Exit Sub
    End If

    Set objMail = Application.ActiveExplorer.Selection.Item(1)

    If objMail.Class = olMail Then
        doClipboard.SetText &#34;[[outlook:&#34; + objMail.EntryID + &#34;][MESSAGE: &#34; + objMail.Subject + &#34; (&#34; + objMail.SenderName + &#34;)]]&#34;
    ElseIf objMail.Class = olAppointment Then
        doClipboard.SetText &#34;[[outlook:&#34; + objMail.EntryID + &#34;][MEETING: &#34; + objMail.Subject + &#34; (&#34; + objMail.Organizer + &#34;)]]&#34;
    ElseIf objMail.Class = olTask Then
        doClipboard.SetText &#34;[[outlook:&#34; + objMail.EntryID + &#34;][TASK: &#34; + objMail.Subject + &#34; (&#34; + objMail.Owner + &#34;)]]&#34;
    ElseIf objMail.Class = olContact Then
        doClipboard.SetText &#34;[[outlook:&#34; + objMail.EntryID + &#34;][CONTACT: &#34; + objMail.Subject + &#34; (&#34; + objMail.FullName + &#34;)]]&#34;
    ElseIf objMail.Class = olJournal Then
        doClipboard.SetText &#34;[[outlook:&#34; + objMail.EntryID + &#34;][JOURNAL: &#34; + objMail.Subject + &#34; (&#34; + objMail.Type + &#34;)]]&#34;
    ElseIf objMail.Class = olNote Then
        doClipboard.SetText &#34;[[outlook:&#34; + objMail.EntryID + &#34;][NOTE: &#34; + objMail.Subject + &#34; (&#34; + &#34; &#34; + &#34;)]]&#34;
    Else
        doClipboard.SetText &#34;[[outlook:&#34; + objMail.EntryID + &#34;][ITEM: &#34; + objMail.Subject + &#34; (&#34; + objMail.MessageClass + &#34;)]]&#34;
    End If

    doClipboard.PutInClipboard
End Sub
</code></pre></li><li><p>in visual basic editor window select <code>Tools > References</code>, if the option is disabled (grayed) then try to close all office apps and restart it, then click <code>browse...</code> and add <code>FM20.dll</code></p></li><li><p>then run <code>SELFCERT.exe</code> in office folder and create personal certificate</p></li><li><p>in visual basic editor window select <code>Tools > Digital signature</code>, choose the created certificate.</p></li><li><p>you should be able to run the macro now, you can further add the macro to the quick access toolbar through <code>File > Options > QuickAccessToolbar > choose commands from: Macro > your Macro</code></p></li></ul></li><li><p>Create registry entry for handling links to outlook object:</p><pre tabindex=0><code class=language-nil data-lang=nil>Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\outlook]
@=&#34;URL:Outlook Folders&#34;
&#34;URL protocol&#34;=&#34;&#34;

[HKEY_CLASSES_ROOT\outlook\DefaultIcon]
@=&#34;C:\\Program Files\\Microsoft Office\\root\\Office16\\OUTLOOK.EXE&#34;

[HKEY_CLASSES_ROOT\outlook\shell]

[HKEY_CLASSES_ROOT\outlook\shell\open]

[HKEY_CLASSES_ROOT\outlook\shell\open\command]
@=&#34;\&#34;C:\\Program Files\\Microsoft Office\\root\\Office16\\OUTLOOK.EXE\&#34; /select \&#34;%1\&#34;&#34;
</code></pre></li><li><p>Setup org-mode
in your own emacs configuration put:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl><span class=p>(</span><span class=nv>org-link-set-parameters</span> <span class=s>&#34;outlook&#34;</span> <span class=nb>:follow</span> <span class=p>(</span><span class=nb>lambda</span> <span class=p>(</span><span class=nv>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                             <span class=p>(</span><span class=nb>cond</span> <span class=p>(</span><span class=nv>IS-WSL</span>
</span></span><span class=line><span class=cl>                                                    <span class=p>(</span><span class=nv>shell-command</span> <span class=p>(</span><span class=nf>concat</span> <span class=s>&#34;wslview &#34;</span> <span class=s>&#34;outlook:&#34;</span> <span class=nv>id</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>                                                   <span class=p>(</span><span class=nv>IS-WINDOWS</span>
</span></span><span class=line><span class=cl>                                                    <span class=p>(</span><span class=nf>w32-shell-execute</span> <span class=s>&#34;open&#34;</span> <span class=p>(</span><span class=nf>concat</span> <span class=s>&#34;outlook:&#34;</span> <span class=nv>id</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>                                                   <span class=p>)))</span>
</span></span></code></pre></div></li></ul><h2 id=insert-windows-files-into-emacs-wsl2>insert windows files into emacs@wsl2<a hidden class=anchor aria-hidden=true href=#insert-windows-files-into-emacs-wsl2>#</a></h2><p>since emacs runs in wsl, we cannot drag and drop files between windows and emacs@wsl2. so i wrote a simple script to get the path of files in windows, and convert it to path in wsl2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>file_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>abspath</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\\</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;/&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;C:&#34;</span><span class=p>,</span> <span class=s2>&#34;/mnt/c&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>wsl_path_prefix</span> <span class=o>=</span> <span class=s2>&#34;//wsl$/Ubuntu/&#34;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>file_path</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>wsl_path_prefix</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>file_path</span> <span class=o>=</span> <span class=n>file_path</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>wsl_path_prefix</span><span class=p>,</span> <span class=s2>&#34;/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>command</span> <span class=o>=</span> <span class=s2>&#34;echo &#34;</span> <span class=o>+</span> <span class=n>file_path</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=o>+</span> <span class=s2>&#34;| clip&#34;</span>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=n>command</span><span class=p>)</span>
</span></span></code></pre></div><p>then I create the context menu <code>WSL Path</code> by the registry file</p><pre tabindex=0><code class=language-nil data-lang=nil>Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\*\shell\Copy WSL path]
@=&#34;WSL Path&#34;

[HKEY_CLASSES_ROOT\*\shell\Copy WSL path\Command]
@=&#34;\&#34;C:\\Users\\username\\scoop\\apps\\python\\current\\pythonw.exe\&#34; \&#34;C:\\path\\to\\wsl_path.py\&#34; \&#34;%1\&#34;&#34;
</code></pre><h2 id=share-clipboard-between-windows-host-and-wsl2>share clipboard between windows host and WSL2<a hidden class=anchor aria-hidden=true href=#share-clipboard-between-windows-host-and-wsl2>#</a></h2><p>this is done by using powershell to get clipboard image saved and read the image into xclip for clipboard access in WSL2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl><span class=p>(</span><span class=nb>defun</span> <span class=nv>win2wsl-clipped-image</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;use powershell to save the clipped image to wsl and load it to xclip&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>let*</span> <span class=p>((</span><span class=nv>powershell</span> <span class=s>&#34;/mnt/c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>         <span class=p>(</span><span class=nv>file-name</span> <span class=s>&#34;//wsl$/Ubuntu/home/mpnv38/tmp/clip_win2wsl.png&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>         <span class=p>(</span><span class=nv>file-name-wsl</span> <span class=s>&#34;~/tmp/clip_win2wsl.png&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>         <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nv>shell-command</span> <span class=p>(</span><span class=nf>concat</span> <span class=nv>powershell</span> <span class=s>&#34; -noprofile -command \&#34;(Get-Clipboard -Format Image).Save(\\\&#34;&#34;</span> <span class=nv>file-name</span> <span class=s>&#34;\\\&#34;)\&#34;&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nv>call-process-shell-command</span> <span class=p>(</span><span class=nf>concat</span> <span class=s>&#34;xclip -selection clipboard -t image/png -i &#34;</span> <span class=nv>file-name-wsl</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nv>advice-add</span> <span class=ss>&#39;org-download-clipboard</span> <span class=nb>:before</span> <span class=nf>#&#39;</span><span class=nv>win2wsl-clipped-image</span><span class=p>)</span>
</span></span></code></pre></div><p>This is it, let me know in comments if you have any question or suggestion!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://shelper.github.io/tags/emacs/>emacs</a></li></ul><nav class=paginav><a class=next href=https://shelper.github.io/posts/setup-hugo-with-github-pages/><span class=title>Next Page Â»</span><br><span>setup hugo with github pages on github</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Emacs in WSL2 on twitter" href="https://twitter.com/intent/tweet/?text=Emacs%20in%20WSL2&url=https%3a%2f%2fshelper.github.io%2fposts%2fsetup-emacs-in-wsl2%2f&hashtags=emacs"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Emacs in WSL2 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fshelper.github.io%2fposts%2fsetup-emacs-in-wsl2%2f&title=Emacs%20in%20WSL2&summary=Emacs%20in%20WSL2&source=https%3a%2f%2fshelper.github.io%2fposts%2fsetup-emacs-in-wsl2%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Emacs in WSL2 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fshelper.github.io%2fposts%2fsetup-emacs-in-wsl2%2f&title=Emacs%20in%20WSL2"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Emacs in WSL2 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fshelper.github.io%2fposts%2fsetup-emacs-in-wsl2%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></div></footer><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://shelper.github.io/posts/setup-emacs-in-wsl2/",this.page.identifier="https://shelper.github.io/posts/setup-emacs-in-wsl2/"};(function(){var e=document,t=e.createElement("script");t.src="https://shelper.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></article><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=shelper data-description="Support me on Buy me a coffee!" data-message data-color=#414244 data-position=Right data-x_margin=18 data-y_margin=18></script></main><footer class=footer><span>&copy; 2022 <a href=https://shelper.github.io/>So I Write</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>